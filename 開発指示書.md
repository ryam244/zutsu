# Claude アプリ開発指示書 v1.0

## 🎯 開発コンセプト

**「ライブラリ競合ゼロ・一発起動を絶対に実現する」**

- ClaudeCodeで完全に仕上げる
- GitHub push → Mac pull → `npm install` → `expo start` が一発で成功
- 毎回の不具合・競合を完全に排除した設計

---

## 📦 技術スタック（固定）

```yaml
基本構成:
  - React Native + Expo (SDK 52)
  - TypeScript (strict mode)
  - ESLint + Prettier (標準設定)

データ保存（案件で選択）:
  Pattern A: 本体保存（AsyncStorage or expo-sqlite）
  Pattern B: Firebase（Auth + Firestore + Storage + Cloud Functions）

状態管理:
  - Zustand（軽量・シンプル）
  - React Query（サーバーデータ）

ナビゲーション:
  - Expo Router（ファイルベースルーティング）

UI/UX:
  - アイコン: 細い線のミニマルデザイン（@expo/vector-icons or react-native-vector-icons/Feather）
  - フォント: Apple仕様準拠（SF Pro相当）
  - テーマ: グローバル管理（ハードコード禁止）
```

---

## 🚀 プロジェクト初期化手順

### 1. 新規プロジェクト作成

```bash
# ClaudeCode上で実行
npx create-expo-app@latest my-app --template blank-typescript
cd my-app

# 必須パッケージインストール（バージョン固定）
npm install zustand@4.5.0 expo-router@3.5.0

# Firebase使う場合
npm install firebase@10.12.0 @react-native-firebase/app@20.0.0

# アイコン（細線ミニマル）
npm install @expo/vector-icons@14.0.0

# ESLint/Prettier
npm install --save-dev eslint@8.57.0 prettier@3.2.5 @typescript-eslint/eslint-plugin@7.0.0
```

### 2. 初期設定ファイル

**`.eslintrc.js`**
```javascript
module.exports = {
  extends: ['expo', 'prettier'],
  plugins: ['@typescript-eslint'],
  rules: {
    'no-unused-vars': 'warn',
    '@typescript-eslint/no-unused-vars': 'warn',
  },
};
```

**`.prettierrc`**
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2
}
```

**`tsconfig.json`** (strict mode)
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

---

## 🎨 UI実装ワークフロー

### Step 1: Google Stitch分析

```
1. Stitchで生成したHTMLを開く
2. DevToolsで以下を計測:
   - 余白（padding/margin）
   - フォントサイズ・ウェイト
   - 色コード（RGB値）
   - 要素の配置（Flexbox or Grid）
```

### Step 2: テーマファイル作成

**`src/theme/index.ts`** (必ず最初に作成)

```typescript
export const theme = {
  colors: {
    primary: '#007AFF',
    background: '#FFFFFF',
    text: '#000000',
    // Stitchから抽出した色を全て定義
  },
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32,
    // Stitchの余白を全て定義
  },
  typography: {
    h1: { fontSize: 28, fontWeight: '700' },
    h2: { fontSize: 22, fontWeight: '600' },
    body: { fontSize: 16, fontWeight: '400' },
    caption: { fontSize: 12, fontWeight: '400' },
    // Apple SF Pro相当のサイズ・ウェイト
  },
  icons: {
    strokeWidth: 1.5, // 細線ミニマル
    size: {
      sm: 20,
      md: 24,
      lg: 28,
    },
  },
};
```

### Step 3: コンポーネント作成

```typescript
// src/components/Button.tsx（例）
import { theme } from '@/theme';

interface ButtonProps {
  title: string;
  onPress: () => void;
  variant?: 'primary' | 'secondary';
}

export const Button: React.FC<ButtonProps> = ({ title, onPress, variant = 'primary' }) => {
  return (
    <Pressable
      style={[
        styles.base,
        variant === 'primary' ? styles.primary : styles.secondary,
      ]}
      onPress={onPress}
    >
      <Text style={styles.text}>{title}</Text>
    </Pressable>
  );
};

const styles = StyleSheet.create({
  base: {
    padding: theme.spacing.md,
    borderRadius: 8,
  },
  primary: {
    backgroundColor: theme.colors.primary,
  },
  // ... Stitchのデザインを完全再現
});
```

**🚫 禁止事項**
- ハードコードされた色・サイズ（`#FF0000`, `16px`等）
- 画像にない要素の勝手な追加
- 「// ここにコードを追加」などの省略

---

## ✅ テスト・ビルド チェックリスト

### Expo起動前チェック

```bash
# 1. 依存関係の整合性確認
npm ls

# 2. TypeScriptエラーチェック
npx tsc --noEmit

# 3. Lintエラーチェック
npx eslint .

# 4. 起動
npx expo start
```

**必須確認項目:**
- [ ] アプリが起動する（ホワイトアウトなし）
- [ ] ロゴ画面でフリーズしない
- [ ] 全画面に遷移できる
- [ ] リンク切れがない（404エラーなし）
- [ ] 戻るボタンで正常に戻れる

### ビルド前チェック

**`app.json` 必須設定**
```json
{
  "expo": {
    "name": "MyApp",
    "slug": "my-app",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png", // 1024x1024
    "splash": {
      "image": "./assets/splash.png", // 2048x2048
      "backgroundColor": "#ffffff"
    },
    "ios": {
      "bundleIdentifier": "com.yourcompany.myapp",
      "buildNumber": "1",
      "supportsTablet": true,
      "infoPlist": {
        "NSPhotoLibraryUsageDescription": "写真を保存するために必要です",
        "NSCameraUsageDescription": "カメラを使用するために必要です"
      }
    },
    "plugins": [
      "expo-router"
    ]
  }
}
```

**ストア申請チェックリスト:**
- [ ] アプリ名・説明文が適切
- [ ] アイコン（1024x1024）設定済み
- [ ] スプラッシュ画面設定済み
- [ ] プライバシーポリシーURL設定（必要な場合）
- [ ] 年齢制限設定
- [ ] 権限（カメラ・写真等）の説明文が適切
- [ ] ホワイトアウト・フリーズがない
- [ ] 全機能が動作する

---

## 📂 プロジェクト構成

```
my-app/
├── app/              # Expo Routerのルート
│   ├── (tabs)/       # タブナビゲーション
│   ├── _layout.tsx   # ルートレイアウト
│   └── index.tsx     # ホーム画面
├── src/
│   ├── components/   # 再利用可能なUI部品
│   ├── screens/      # 画面コンポーネント
│   ├── hooks/        # カスタムフック
│   ├── stores/       # Zustand store
│   ├── services/     # API・Firebase通信
│   ├── utils/        # ヘルパー関数
│   └── theme/        # グローバルテーマ（必須）
├── assets/           # 画像・フォント
├── docs/
│   ├── 企画書_最新.md
│   └── TODO.md
├── .eslintrc.js
├── .prettierrc
├── tsconfig.json
└── app.json
```

---

## 🔄 GitHub運用ルール

### ブランチ戦略

```
main    ← リリース版（App Store公開中）
develop ← 開発中（ここで作業）
```

### ワークフロー

```bash
# 1. 開発開始
git checkout develop
git pull origin develop

# 2. 作業後コミット
git add .
git commit -m "feat: ○○機能を実装"
git push origin develop

# 3. リリース時
git checkout main
git merge develop
git tag v1.0.0
git push origin main --tags

# 4. Macでpull
git pull origin develop
npm install
npx expo start
```

---

## 🛠️ トラブルシューティング

### よくある競合と解決策

**1. Metro Bundlerエラー**
```bash
# キャッシュクリア
npx expo start -c
```

**2. node_modules不整合**
```bash
rm -rf node_modules package-lock.json
npm install
```

**3. iOS Simulatorで表示されない**
```bash
# Xcodeキャッシュクリア
rm -rf ~/Library/Developer/Xcode/DerivedData
```

**4. TypeScriptエラー**
```bash
# 型定義再生成
npx expo install --fix
```

---

## 📋 ドキュメント更新ルール

### 企画書_最新.md

毎回のプラン変更時に更新：

```markdown
# アプリ名

## 概要
[アプリの目的・ターゲット]

## 主要機能
- 機能1
- 機能2

## 画面構成
1. ホーム画面
2. 詳細画面
...

## 技術仕様
- データ保存: 本体 or Firebase
- 外部API: あり/なし
- 決済: あり/なし

## 更新履歴
- 2025-01-19: 初版作成
```

### TODO.md

```markdown
# TODO

## 🚀 今すぐやること
- [ ] タスク1
- [ ] タスク2

## 📅 今後やること
- [ ] タスク3
- [ ] タスク4

## ✅ 完了
- [x] タスク0
```

---

## 🎯 コーディング規約（厳守）

### Workflow (Step-by-Step)

1. **Visual Analysis:** Google Stitch UIをピクセルレベルで分析
2. **Theming Setup:** `src/theme/index.ts` を最初に作成（ハードコード禁止）
3. **Component Creation:** 再利用可能なコンポーネントに分割
4. **Screen Assembly:** コンポーネントを組み合わせて画面構築
5. **Logic Integration:** 画面遷移・状態管理を実装
6. **Refinement:** エラー処理・ローディング・データなし状態を実装

### Rules & Constraints

- **Dependencies:** バージョンを固定（`package.json`で明記）
- **UI Fidelity:** Stitchのデザインを「正解」とする
- **Clean Code:** ロジックとUIを分離
- **Completeness:** 省略なし、完全に動作するコードのみ
- **Font:** Apple仕様準拠、視認性最優先
- **Icons:** 細い線のミニマルデザイン（stroke-width: 1.5程度）

---

## ⚠️ 絶対厳守事項

### コーディング前

**必ず確認してから進める**
- 「こういうコードを書くと○○が変化します」を説明
- 既存機能が損なわれないか確認
- 損なう可能性がある場合は事前確認

### 勝手に進めない

❌ 「では実装します！」→ いきなりコード作成
✅ 「○○機能を追加すると、△△画面が変わりますが進めますか？」

---

## 📞 サポート

質問・不明点があれば、この指示書を参照しながら進めてください。
指示書の更新が必要な場合は、バージョン番号を上げて履歴を残すこと。

---

**作成日:** 2025-01-19  
**バージョン:** v1.0  
**最終更新:** 2025-01-19
